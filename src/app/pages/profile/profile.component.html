
<div class="profile-container max-w-4xl mx-auto py-12 px-4">
  <h2 class="text-3xl font-bold mb-6 font-serif text-blue-800">My Profile</h2>

  <div *ngIf="user as u; else notLoggedIn"
       class="profile-card bg-white rounded-xl shadow-lg p-6 transition-transform transform hover:-translate-y-1 hover:shadow-2xl">
    
    <!-- User Info -->
    <div class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6 mb-6">
      <img
        *ngIf="u.photoURL; else defaultAvatar"
        [src]="u.photoURL"
        [alt]="u.displayName || 'Profile Photo'"
        class="profile-photo w-24 h-24 rounded-full shadow-md object-cover border-2 border-teal-400"
      />
      <ng-template #defaultAvatar>
        <div class="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center text-2xl text-gray-500 shadow-md border-2 border-teal-400">
          {{ u.displayName ? u.displayName.charAt(0) : 'U' }}
        </div>
      </ng-template>

      <div class="text-center sm:text-left">
        <h3 class="text-xl font-serif font-semibold">{{ u.displayName || 'User' }}</h3>
        <p class="text-gray-600 font-sans">{{ u.email }}</p>
        <p *ngIf="u.metadata?.creationTime" class="text-gray-400 text-sm mt-1">
          Member since: {{ u.metadata?.creationTime | date:'mediumDate' }}
        </p>
      </div>
    </div>

    <hr class="my-6 border-gray-200">

    <!-- My Bookings Section -->
    <h4 class="text-lg font-semibold mb-4 font-serif">My Bookings</h4>

    <!-- Error Message -->
    <div *ngIf="error" class="text-red-500 text-sm mb-4">
      {{ error }}
    </div>

    <!-- Skeleton Loader -->
    <div *ngIf="loading" class="space-y-4 animate-pulse">
      <div *ngFor="let s of [1,2,3]" class="skeleton-card h-28 bg-gray-200 rounded-lg"></div>
    </div>

    <!-- No Bookings -->
    <div *ngIf="!loading && bookings.length === 0 && !error" class="text-gray-500 font-sans text-center">
      You have no bookings yet.
    </div>

    <!-- Bookings List -->
    <ul *ngIf="!loading && bookings.length > 0" class="grid gap-4 sm:grid-cols-1 md:grid-cols-2">
      <li *ngFor="let b of bookings" class="booking-card border rounded-lg p-4 bg-white shadow hover:shadow-lg transition-shadow duration-300 relative group">
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start space-y-2 sm:space-y-0">
          <div class="space-y-1 sm:pr-4">
            <p><strong>Destination:</strong> {{ b.destination }}</p>
            <p><strong>Date:</strong> {{ b.date | date:'longDate' }}</p>
            <p><strong>People:</strong> {{ b.people }}</p>
            <p><strong>Price:</strong> â‚¹{{ b.price * b.people }}</p>
            <p *ngIf="b.notes" class="text-gray-500 text-sm">Notes: {{ b.notes }}</p>
          </div>

          <!-- Cancel Button -->
          <div class="flex items-center sm:flex-col sm:space-y-2">
            <button 
              class="cancel-btn text-red-500 border border-red-500 hover:text-white hover:bg-red-500 px-3 py-1 rounded transition-colors"
              [attr.aria-label]="'Cancel Booking for ' + b.destination"
              (click)="cancelBooking(b.id!)">
              Cancel
            </button>
          </div>
        </div>

        <!-- Booking Status Badge -->
        <span *ngIf="b.status" class="absolute top-2 right-2 px-2 py-1 text-xs font-semibold rounded-full"
              [ngClass]="{
                'bg-green-200 text-green-800': b.status === 'Confirmed',
                'bg-yellow-200 text-yellow-800': b.status === 'Pending',
                'bg-red-200 text-red-800': b.status === 'Cancelled'
              }">
          {{ b.status }}
        </span>
      </li>
    </ul>

    <!-- Extra Quick Actions -->
    <div class="mt-6">
      <h5 class="font-serif font-semibold mb-2">Quick Actions</h5>
      <div class="flex flex-wrap gap-2">
        <button routerLink="/booking" class="bg-teal-500 text-white px-3 py-1 rounded hover:bg-teal-600 transition">Book a Trip</button>
        <button routerLink="/blog" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition">Read Travel Blogs</button>
        <button routerLink="/destinations" class="bg-orange-400 text-white px-3 py-1 rounded hover:bg-orange-500 transition">Explore Destinations</button>
      </div>
    </div>
  </div>

  <!-- Not Logged In -->
  <ng-template #notLoggedIn>
    <p class="text-center text-gray-500 mt-10 font-sans">
      You are not logged in. 
      <a routerLink="/login" class="text-teal-500 font-semibold hover:underline">Login here</a>
    </p>
  </ng-template>
</div>
